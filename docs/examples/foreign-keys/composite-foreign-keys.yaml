# Composite Foreign Keys Example
# Demonstrates foreign keys that reference composite primary keys

columns:
  id:
    type: integer
    sequence: true
    primary_key: true

  name:
    type: varchar
    size: 100

  code:
    type: varchar
    size: 10

tables:
  countries:
    columns:
      country_code:
        $ref: code
        primary_key: true

      country_name:
        $ref: name

  states:
    # Composite primary key
    columns:
      country_code:
        $ref: code
        primary_key: true

      state_code:
        $ref: code
        primary_key: true

      state_name:
        $ref: name

    foreign_keys:
      # Simple FK to countries
      country_fk:
        table: countries
        columns:
          country_code: country_code

  cities:
    foreign_keys:
      # Composite foreign key referencing states table
      state_fk:
        table: states
        columns:
          country_code: country_code  # local_column: referenced_column
          state_code: state_code

    columns:
      city_id:
        $ref: id

      city_name:
        $ref: name

      # Foreign key columns (composite)
      country_code:
        $ref: code
        required: true

      state_code:
        $ref: code
        required: true

      population:
        type: integer

# Alternative syntax for composite FKs with different column names:
  addresses:
    foreign_keys:
      location_fk:
        table: states
        columns:
          addr_country: country_code  # addr_country references states.country_code
          addr_state: state_code      # addr_state references states.state_code

    columns:
      address_id:
        $ref: id

      street_address:
        type: varchar
        size: 200

      # Different column names for the FK
      addr_country:
        $ref: code
        required: true

      addr_state:
        $ref: code
        required: true

# What this generates:
# 1. countries: country_code (PK), country_name
# 2. states: (country_code, state_code) composite PK, state_name
# 3. cities: city_id (PK), city_name, country_code, state_code, population
# 4. addresses: address_id (PK), street_address, addr_country, addr_state
#
# Foreign key constraints:
# - states.country_code REFERENCES countries(country_code)
# - cities.(country_code, state_code) REFERENCES states(country_code, state_code)
# - addresses.(addr_country, addr_state) REFERENCES states(country_code, state_code)
#
# Example data:
# countries: ('US', 'United States'), ('CA', 'Canada')
# states: ('US', 'NY', 'New York'), ('US', 'CA', 'California')
# cities: (1, 'New York City', 'US', 'NY', 8000000)