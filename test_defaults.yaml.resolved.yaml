_metadata:
  generated_at: 2025-09-30T17:07:31.026Z
  source_schema: ./test_defaults.yaml
  database: test
  genlogic_version: 1.0.0
  note: This describes the ACTUAL database structure after GenLogic processing
  warning: ⚠️  DO NOT implement automations in middleware - they run in the database!
tables:
  parent:
    _table_info:
      has_triggers: true
      has_automations: true
      foreign_keys: 0
    columns:
      parent_id:
        type: integer
        nullable: false
        primary_key: true
        writable: never
        reason: auto_increment_sequence
        insert_behavior: omit
        update_behavior: immutable
        note: Database generates this value
      total_sum:
        type: numeric
        size: 10
        decimal: 2
        nullable: true
        writable: never
        reason: database_automation
        managed_by:
          type: trigger_aggregation
          automation_type: SUM
          source_table: child
          source_column: amount
          trigger_name: child_before_insert_genlogic
          aggregation_path: child.parent_fk -> parent
          update_strategy: incremental
          note: Aggregates SUM from child.amount
        insert_behavior: omit
        update_behavior: forbidden
        query_note: Always reflects current state via triggers
        warning: ⚠️  AUTOMATED IN DATABASE - DO NOT SET IN APPLICATION
      child_count:
        type: integer
        nullable: true
        writable: never
        reason: database_automation
        managed_by:
          type: trigger_aggregation
          automation_type: COUNT
          source_table: child
          source_column: amount
          trigger_name: child_before_insert_genlogic
          aggregation_path: child.parent_fk -> parent
          update_strategy: incremental
          note: Aggregates COUNT from child.amount
        insert_behavior: omit
        update_behavior: forbidden
        query_note: Always reflects current state via triggers
        warning: ⚠️  AUTOMATED IN DATABASE - DO NOT SET IN APPLICATION
      description:
        type: varchar
        size: 100
        nullable: true
        writable: always
        insert_behavior: optional
        update_behavior: allowed
        note: Application controls this value
  child:
    _table_info:
      has_triggers: false
      has_automations: false
      foreign_keys: 1
    columns:
      child_id:
        type: integer
        nullable: false
        primary_key: true
        writable: never
        reason: auto_increment_sequence
        insert_behavior: omit
        update_behavior: immutable
        note: Database generates this value
      amount:
        type: numeric
        size: 10
        decimal: 2
        nullable: true
        writable: always
        insert_behavior: optional
        update_behavior: allowed
        note: Application controls this value
      parent_id:
        type: integer
        nullable: true
        writable: always
        source: foreign_key_column
        references:
          table: parent
          column: parent_id
          constraint: parent_fk
        insert_behavior: optional
        update_behavior: allowed
        note: Application controls this value to establish relationships
_usage_guide:
  insert_pattern: |-
    To insert data, only include columns where writable=always and insert_behavior != omit.
    Example for accounts:
      INSERT INTO accounts (account, category) VALUES ('Checking', 'Asset');

    ❌ WRONG - don't set automated columns:
      INSERT INTO accounts (account, category, debits, balance) VALUES (...);
  update_pattern: |-
    To update data, only modify columns where writable=always and update_behavior=allowed.
    Example for accounts:
      UPDATE accounts SET category = 'Liability' WHERE id = 5;

    ❌ WRONG - don't update automated columns:
      UPDATE accounts SET balance = 1000 WHERE id = 5;  -- Will be overwritten!
  query_pattern: |-
    All columns are readable. Automated columns are always current - no need to recalculate.
    Example:
      SELECT account, category, balance FROM accounts WHERE category = 'Asset';

    The balance is ALWAYS up-to-date due to database triggers.
  automation_philosophy: |-
    GenLogic implements "Augmented Normalization":
    - Write normalized data (accounts, ledger entries)
    - Read denormalized data (balances pre-calculated)
    - Middleware NEVER calculates aggregations or balances
    - Database maintains ALL computed values via triggers
    - Zero middleware business logic = zero bugs
