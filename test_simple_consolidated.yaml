# Simpler test without FETCH_UPDATES to avoid cycle detection
tables:
  accounts:
    columns:
      account_id: { type: integer, primary_key: true, sequence: true }
      balance:
        type: numeric
        size: 10
        decimal: 2
        automation:
          type: SUM
          table: transactions
          foreign_key: account_fk
          column: amount
      balance_doubled:
        type: numeric
        size: 10
        decimal: 2
        calculated: "COALESCE(balance, 0) * 2"

  transactions:
    foreign_keys:
      account_fk: { table: accounts }
    columns:
      transaction_id: { type: integer, primary_key: true, sequence: true }
      amount: { type: numeric, size: 10, decimal: 2 }
      tax:
        type: numeric
        size: 10
        decimal: 2
        calculated: "COALESCE(amount, 0) * 0.1"